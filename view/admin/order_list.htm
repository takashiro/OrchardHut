{template header}

<script type="text/javascript" src="./plugin/datetimepicker/jquery.datetimepicker.min.js"></script>
<style type="text/css">@import url(./plugin/datetimepicker/jquery.datetimepicker.css);</style>
<script type="text/javascript">
$(function(){
	$('input.datetime').datetimepicker({
		lang : 'cn',
		i18n : {
			cn : {
				months : [
					'1月','2月','3月','4月',
					'5月','6月','7月','8月',
					'9月','10月','11月','12月',
				],
				dayOfWeek : [
					"日", "一", "二", "三", 
					"四", "五", "六",
				]
			}
		},
		format : 'Y-m-d H:i',
	});
});
</script>

<div class="box">
	<h1>订单管理</h1>
	<div class="content">
		<form class="quick_search" action="$mod_url" method="post">
			<dl>
				<dt>订单号：</dt>
				<dd><input type="text" name="orderid" style="width:3em" /></dd>
				<dt>时间：</dt>
				<dd><input type="text" name="time_start" class="datetime" value="$time_start" /> - <input type="text" name="time_end" class="datetime" value="$time_end" /></dd>
				<dt>统计：</dt>
				<dd>{echo Template::checkbox('stat[totalprice]', '总价格', isset($stat['totalprice']))}</dd>
			</dl>
			<dl>
				<dt>订单送货地址：</dt>
				<dd>{echo Template::tselect('delivery_address', $address_format, $address_components, false, $componentid)}</dd>
				<dt>订单状态：</dt>
				<dd>
					<!--{loop $available_status $id $checked}-->
					{echo Template::checkbox("display_status[$id]", Order::$Status[$id], $checked)}
					<!--{/loop}-->
				</dd>
			</dl>
			<button type="submit">查找</button>
		</form>

		<!--{if $_G['admin']->isSuperAdmin()}-->
		<form class="quick_search" action="admin.php" method="get">
			<input type="hidden" name="mod" value="order" />
			<dl>
				<dt>订单号：</dt>
				<dd><input type="text" name="orderid" style="width:3em" /></dd>
				<dt>状态：</dt>
				<dd>{echo Template::select('action', array('mark_unsorted' => '待出库', 'mark_delivering' => '配送中', 'mark_delivered' => '已签收', 'mark_rejected' => '已拒收'))}</dd>
			</dl>
			<button type="submit">修改</button>
		</form>
		<!--{/if}-->

		<div id="orderlist" class="list">
			<table>
				<thead>
					<tr>
						<td>编号</td>
					<!--{loop Address::Format() $f}-->
						<td>$f[name]</td>
					<!--{/loop}-->
						<td>地址</td>
						<td>收件人</td>
						<td>物品</td>
						<td>价格</td>
						<td>状态</td>
						<td width="100">时间</td>
						<td width="50">操作</td>
						<td>留言</td>
					</tr>
				</thead>
				<tbody>
					<!--{loop $orders $o}-->
					<tr primaryvalue="$o[id]">
						<td>$o[id]</td>
						<!--{loop Address::Format() $format}-->
							<td>{echo $o['address'][$format['id']]}</td>
						<!--{/loop}-->
						<td>$o[extaddress]</td>
						<td>$o[addressee]<br />$o[mobile]</td>
						<td>$o[items]</td>
						<td>$o[totalprice] $o[priceunit]</td>
						<td>
							{echo Order::$Status[$o['status']]}
							<!--{if $o['status'] == 0 && $_G['admin']->hasPermission('order_sort_w')}-->
							<div><a href="{$mod_url}&action=mark_delivering&orderid=$o[id]" title="将订单标记为已打包">[已打包]</a></div>
							<!--{elseif $o['status'] == 1 && $_G['admin']->hasPermission('order_deliver_w')}-->
							<div><a href="{$mod_url}&action=mark_received&orderid=$o[id]" title="将订单标记为已签收">[已签收]</a></div>
							<div><a href="{$mod_url}&action=mark_rejected&orderid=$o[id]" title="将订单标记为已拒收">[已拒收]</a></div>
							<!--{/if}-->
						</td>
						<td>{echo rdate($o['dateline'])}</td>
						<td>
							<a href="$mod_url&action=print&orderid=$o[id]" target="_blank">[打印]</a>
							<!--{if $o['status'] == 0}-->
							<br /><a href="$mod_url&action=delete&orderid=$o[id]">[删除]</a>
							<!--{/if}-->
						</td>
						<td style="width:10%;"><div style="font-size:9pt;max-height:100px;overflow-y:auto;">$o[message]</div></td>
					</tr>
					<!--{/loop}-->
					<!--{if !empty($stat)}-->
					<tr>
							<td>总计</td>
							<td colspan="{echo count(Address::Format()) + 1}"></td>
							<td colspan="2">$pagenum 个订单</td>
							<td>$stat[totalprice] 元</td>
							<td colspan="4"></td>
					</tr>
					<!--{/if}-->
				</tbody>
			</table>
		</div>
	</div>
</div>

{echo Template::mpage($pagenum, $page, $limit, $mod_url.'&display_status='.implode(',', $display_status).'&delivery_address='.$delivery_address.'&time_start='.$time_start.'&time_end='.$time_end.$stat_query)}

{template footer}
